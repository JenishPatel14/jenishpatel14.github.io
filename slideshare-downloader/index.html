<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SlideShare Downloader</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #progress-container {
      display: none;
      margin-top: 20px;
    }
    #progress-bar {
      width: 0%;
      height: 20px;
      background-color: #28a745;
      text-align: center;
      color: white;
      line-height: 20px;
    }
  </style>
</head>
<body class="p-4">
  <h1 class="text-center mb-4">SlideShare Downloader</h1>
  <p class="text-center text-muted">Note: File generation happens in your browser and may take 5â€“10 seconds depending on the number of slides.</p>

  <div class="container">
    <input type="url" id="slideshare-url" class="form-control mb-3" placeholder="Enter SlideShare URL" />
    <button onclick="fetchSlides()" class="btn btn-primary w-100">Fetch Slides</button>

    <div class="mt-4" id="download-section" style="display:none;">
      <p><strong>Slides Fetched:</strong> <span id="slide-count"></span></p>
      <button class="btn btn-outline-success w-100 mb-2" onclick="downloadZIP()">Download as ZIP</button>
      <button class="btn btn-outline-danger w-100 mb-2" onclick="downloadPDF()">Download as PDF</button>
      <button class="btn btn-outline-secondary w-100" onclick="downloadPPT()">Download as PPT (via server)</button>
    </div>

    <div id="progress-container" class="progress">
      <div id="progress-bar"></div>
    </div>
  </div>

  <script>
    const BACKEND_URL = 'https://slideshare.onrender.com';
    let slideImages = [], presentationTitle = 'slideshare';

    function updateProgress(percent) {
      const bar = document.getElementById('progress-bar');
      bar.style.width = percent + '%';
      bar.innerText = percent + '%';
    }

    function showProgress() {
      document.getElementById('progress-container').style.display = 'block';
      updateProgress(0);
    }

    function hideProgress() {
      document.getElementById('progress-container').style.display = 'none';
    }

    async function fetchSlides() {
      const url = document.getElementById('slideshare-url').value.trim();
      if (!url) return alert('Please enter a SlideShare URL');

      const res = await fetch(`${BACKEND_URL}/api/get-slides`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });

      const data = await res.json();
      slideImages = data.default_slides;
      presentationTitle = data.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
      document.getElementById('slide-count').innerText = slideImages.length;
      document.getElementById('download-section').style.display = 'block';
    }

    async function downloadZIP() {
      const zip = new JSZip();
      const folder = zip.folder('slides');
      showProgress();
      for (let i = 0; i < slideImages.length; i++) {
        const blob = await fetch(slideImages[i]).then(r => r.blob());
        folder.file(`slide_${i + 1}.jpg`, blob);
        updateProgress(Math.round((i + 1) / slideImages.length * 100));
      }
      const content = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(content);
      a.download = `${presentationTitle}.zip`;
      a.click();
      hideProgress();
    }

    async function downloadPDF() {
      const pdfDoc = await PDFLib.PDFDocument.create();
      showProgress();
      for (let i = 0; i < slideImages.length; i++) {
        const imgBytes = await fetch(slideImages[i]).then(r => r.arrayBuffer());
        const img = await pdfDoc.embedJpg(imgBytes);
        const page = pdfDoc.addPage([img.width, img.height]);
        page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
        updateProgress(Math.round((i + 1) / slideImages.length * 100));
      }
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${presentationTitle}.pdf`;
      a.click();
      hideProgress();
    }

    async function downloadPPT() {
      if (!slideImages.length) return alert('No slides found');
      showProgress();
      const response = await fetch(`${BACKEND_URL}/api/download-selected`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': 'your-very-secret-key'
        },
        body: JSON.stringify({
          format: 'ppt',
          imageUrls: slideImages,
          title: presentationTitle
        })
      });
      if (!response.ok) {
        alert('Failed to generate PPT');
        hideProgress();
        return;
      }
      const blob = await response.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${presentationTitle}.pptx`;
      a.click();
      hideProgress();
    }

    // JS Obfuscation trick (lightweight, GitHub Pages compatible)
    (function(){
      console.log('%cHey dev! This tool is client-side. Please don\'t misuse the SlideShare API.', 'color: red; font-size: 16px');
    })();
  </script>
</body>
</html>
