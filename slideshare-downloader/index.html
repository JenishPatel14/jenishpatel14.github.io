<!-- Paste this into your GitHub Pages index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SlideShare Downloader</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body class="p-4">
  <h1 class="text-center mb-3">SlideShare Downloader</h1>
  <p class="text-center text-muted">Downloads are processed in your browser (ZIP & PDF). PPT is processed on our server.</p>

  <div class="container">
    <input type="url" id="slideshare-url" class="form-control mb-3" placeholder="Enter SlideShare URL">
    <button onclick="fetchSlides()" class="btn btn-primary w-100">Fetch Slides</button>

    <div id="slide-options" class="mt-4" style="display:none">
      <p><strong>Total Slides:</strong> <span id="slide-count"></span></p>
      <div class="d-grid gap-2">
        <button class="btn btn-outline-success" onclick="downloadZIP()">Download as ZIP</button>
        <button class="btn btn-outline-danger" onclick="downloadPDF()">Download as PDF</button>
        <button class="btn btn-outline-primary" onclick="downloadPPT()">Download as PPT</button>
      </div>
    </div>

    <div id="progress-container" class="progress mt-3" style="display:none">
      <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
    </div>
  </div>

  <script>
    const BACKEND = 'https://slideshare.onrender.com';
    let images = [], title = 'slideshare';

    function updateProgress(p) {
      const bar = document.getElementById('progress-bar');
      bar.style.width = `${p}%`;
      bar.innerText = `${p}%`;
    }

    async function fetchSlides() {
      const url = document.getElementById('slideshare-url').value;
      if (!url) return alert('Please enter a SlideShare URL');
      const res = await fetch(`${BACKEND}/api/get-slides`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });
      const data = await res.json();
      if (!data.success) return alert('Failed to fetch slides.');
      images = data.default_slides;
      title = data.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
      document.getElementById('slide-count').innerText = images.length;
      document.getElementById('slide-options').style.display = 'block';
    }

    async function downloadZIP() {
      document.getElementById('progress-container').style.display = 'block';
      const zip = new JSZip();
      const folder = zip.folder('slides');
      for (let i = 0; i < images.length; i++) {
        const blob = await fetch(images[i]).then(r => r.blob());
        folder.file(`slide_${i + 1}.jpg`, blob);
        updateProgress(Math.floor((i + 1) / images.length * 100));
      }
      const blob = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${title}.zip`;
      a.click();
      document.getElementById('progress-container').style.display = 'none';
    }

    async function downloadPDF() {
      document.getElementById('progress-container').style.display = 'block';
      const pdfDoc = await PDFLib.PDFDocument.create();
      for (let i = 0; i < images.length; i++) {
        const arrayBuffer = await fetch(images[i]).then(r => r.arrayBuffer());
        const image = await pdfDoc.embedJpg(arrayBuffer);
        const page = pdfDoc.addPage([image.width, image.height]);
        page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
        updateProgress(Math.floor((i + 1) / images.length * 100));
      }
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${title}.pdf`;
      a.click();
      document.getElementById('progress-container').style.display = 'none';
    }

    async function downloadPPT() {
      document.getElementById('progress-container').style.display = 'block';
      updateProgress(0);
      const res = await fetch(`${BACKEND}/api/download-selected`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ format: 'ppt', imageUrls: images, title })
      });
      if (!res.ok) return alert('PPT download failed');
      const blob = await res.blob();
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${title}.pptx`;
      a.click();
      updateProgress(100);
      document.getElementById('progress-container').style.display = 'none';
    }
  </script>
</body>
</html>
